let canvas=null,ctx=null,bckCanvas=null,bckCtx=null,dotRingCanvas=null,dotRingCtx=null;const POINT_SIZE=2,HALF_POINT_SIZE=Math.ceil(1),VOLUME_POINT_SIZE=3,HALF_VOLUME_POINT_SIZE=Math.ceil(HALF_POINT_SIZE/2);let ringRStartColor=[146,230,215],ringREndColor=[67,169,216],ringLStartColor=[237,230,128],ringLEndColor=[229,169,114],rippleEnabled=!0,enableFlat=!1,backgroundColorCenter=[76,99,106],backgroundColorEdge=[51,51,51],sensitivity=1,smoother=.5;const dotRingColor="#616161",volumeRingIdicator="#4CAF50",white="#fafafa",version="Venom Sound";let props,globalOpacityOverride=0,logo,background,retAudioArray,leftAudioSide=null,rightAudioSide=null,preL=[],preR=[],current=0,isSound=!1,maxAudioValue=.1,opacity=0,direction=1,min=.2,volumes=null,maxVolumeHeightL=0,maxVolumeHeightR=0,maxL=0,maxR=0,logoOpacity=1,buckets=fillArray(0,10),max_bucket_age=1e3,previous_index,customIconUrl=null,customIconWidth=300,customIconHeight=300,customIcon=null,hasIconLoaded=!1,backgroundImageUrl=null,backgroundBlendMode=1,backgroundImage=null,hasBackgroundLoaded=!1,backgroundGrad=null,backgroundOpacity=1,lastFrame,resolution=128,backgroundInvalidated=!1;const TwoPi=2*Math.PI,HalfCirclePi=Math.PI/180;function sinf(e){return Math.sin(Math.floor(e/TwoPi*resolution)/resolution*TwoPi)}function cosf(e){return Math.cos(Math.floor(e/TwoPi*resolution)/resolution*TwoPi)}let fpsMeter=!1;function setCustomIcon(){"file:///"!==customIconUrl?(logo.childNodes.forEach(e=>{e.style&&(e.style.visibility="hidden")}),(customIcon=new Image).onload=function(){hasIconLoaded=!0},customIcon.src=customIconUrl):(logo.childNodes.forEach(e=>{e.style&&(e.style.visibility="visible")}),hasIconLoaded=!1)}function setBackgroundImage(){backgroundInvalidated=!0,"file:///"!==backgroundImageUrl?((backgroundImage=new Image).onload=function(){hasBackgroundLoaded=!0},backgroundImage.src=backgroundImageUrl):hasBackgroundLoaded=!1}function getBlendMode(e){switch(e){case 1:return"normal";case 2:return"multiply";case 3:return"screen";case 4:return"overlay";case 5:return"darken";case 6:return"lighten";case 7:return"color-dodge";case 8:return"color-burn";case 9:case 14:return"hard-light";case 10:return"soft-light";case 11:return"difference";case 12:return"exclusion";case 13:return"hue";case 15:return"saturation";case 16:return"color";case 17:return"luminosity"}}window.onload=function(){canvas=document.getElementById("canvas"),bckCanvas=document.getElementById("bckCanvas"),dotRingCanvas=document.getElementById("dotRingCanvas"),canvas.width=window.innerWidth,canvas.height=window.innerHeight,bckCanvas.width=window.innerWidth,bckCanvas.height=window.innerHeight,dotRingCanvas.width=window.innerWidth,dotRingCanvas.height=window.innerHeight,ctx=canvas.getContext("2d"),bckCtx=bckCanvas.getContext("2d"),dotRingCtx=dotRingCanvas.getContext("2d"),logo=document.getElementById("logo"),background=document.getElementById("wrapper"),backgroundGrad=document.getElementById("wrapper"),lastFrame=performance.now(),main_animation(),window.wallpaperRegisterAudioListener(wallpaperAudioListener),wallpaperAudioListener(fillArray(0,128))},window.wallpaperPropertyListener={applyUserProperties:function(e){props=e,e.sensitivity&&(sensitivity=e.sensitivity.value),e.smooth&&(smoother=e.smooth.value),e.lChannelMain&&(ringLStartColor=rgb1StringTo255(e.lChannelMain.value),worked=!0),e.lChannelFade&&(ringLEndColor=rgb1StringTo255(e.lChannelFade.value)),e.rChannelMain&&(ringRStartColor=rgb1StringTo255(e.rChannelMain.value)),e.angleResolution&&(resolution=e.angleResolution.value),e.enableFpsMeter&&(fpsMeter=e.enableFpsMeter.value),e.rChannelFade&&(ringREndColor=rgb1StringTo255(e.rChannelFade.value)),e.enableRipple&&(rippleEnabled=e.enableRipple.value),e.bucketlife&&(buckets=fillArray(0,e.bucketlife.value)),e.backgroundCenter&&(backgroundColorCenter=rgb1StringTo255(e.backgroundCenter.value),background.style.background="radial-gradient(ellipse closest-side at center, "+colorToRgb(backgroundColorCenter)+" 0%, "+colorToRgb(backgroundColorEdge)+" 100%)"),e.customIcon&&(customIconUrl="file:///"+e.customIcon.value,setCustomIcon()),e.customBackground&&(backgroundImageUrl="file:///"+e.customBackground.value,setBackgroundImage()),e.backgroundBlendMode&&(backgroundBlendMode=e.backgroundBlendMode.value,setBackgroundImage()),e.backgroundGradOpacity&&(backgroundOpacity=e.backgroundGradOpacity.value,setBackgroundImage()),e.iconW&&(customIconWidth=e.iconW.value,setCustomIcon()),e.iconH&&(customIconHeight=e.iconH.value,setCustomIcon()),e.backgroundEdge&&(backgroundColorEdge=rgb1StringTo255(e.backgroundEdge.value),background.style.background="radial-gradient(ellipse closest-side at center, "+colorToRgb(backgroundColorCenter)+" 0%, "+colorToRgb(backgroundColorEdge)+" 100%)"),e.usingSmallIcons&&(e.usingSmallIcons.value?document.documentElement.style.padding="16px 16px 30px 16px":document.documentElement.style.padding="16px 16px 40px 16px"),e.borderless&&(!0===e.borderless.value?document.getElementsByTagName("HTML")[0].style.padding="0 0 0 0":!1===e.borderless.value&&(document.getElementsByTagName("HTML")[0].style.padding="16px 16px 40px 16px")),e.enableFlatUI&&(enableFlat=e.enableFlatUI.value),last_static_frame_ts=0}};let last_audio_array=null;function getLastAudioArray(){let e=last_audio_array;return last_audio_array=null,e}function handleAudioArray(e){leftAudioSide=getSide(retAudioArray=flip(e=multiplyArray(e,sensitivity)),0),rightAudioSide=getSide(retAudioArray,1),0===buckets.length&&(buckets=fillArray(0,10));let t=0;e.forEach(e=>t=Math.max(t,e));let o=Math.round(new Date/max_bucket_age),a=o-previous_index;if(a>buckets.length&&(a=buckets.length),a>0){for(let n=0;n<a;++n)buckets[(previous_index+n+1)%buckets.length]=0;maxAudioValue=0;for(let l=0;l<buckets.length;++l)buckets[l]>maxAudioValue&&(maxAudioValue=buckets[l])}previous_index=o,buckets[o%=buckets.length]=Math.max(buckets[o],t),t>maxAudioValue&&(maxAudioValue=t)}function wallpaperAudioListener(e){last_audio_array=e}let last_volume_state=!1;function drawStatic(){dotRingCtx.clearRect(0,0,dotRingCanvas.width,dotRingCanvas.height);let e=Math.min(dotRingCanvas.width,dotRingCanvas.height)/2.6;for(let t=0;t<7;t++)drawDotRing(dotRingCtx,dotRingCanvas,e*(1-.1*t),"#616161");last_volume_state&&(drawDotRing(dotRingCtx,dotRingCanvas,1.1*e,colorToRgb(ringRStartColor,.8,1),1),drawDotRing(dotRingCtx,dotRingCanvas,1.13*e,colorToRgb(ringLStartColor,.8,1),1))}function main_animation(){let e=getLastAudioArray();if(null!==e&&(handleAudioArray(e),draw()),fpsMeter){let t=performance.now(),o=1e3/(t-lastFrame);ctx.fillStyle="#ffffff",ctx.fillText("fps: "+o.toFixed(2),10,10),lastFrame=t}requestAnimationFrame(main_animation)}function draw(){ctx.clearRect(0,0,canvas.width,canvas.height),drawBackground(ctx,canvas),drawIcon(ctx,canvas);let e=Math.min(canvas.width,canvas.height)/2.6;3===direction&&(direction=1,opacity=min),isSound?((globalOpacityOverride+=.1)>1&&(globalOpacityOverride=1),(logoOpacity-=.3)<0&&(logoOpacity=0)):((globalOpacityOverride-=.1)<0&&(globalOpacityOverride=0),(logoOpacity+=.05)>1&&(logoOpacity=1)),logo.style.opacity=logoOpacity;let t=null;if(retAudioArray&&leftAudioSide&&rightAudioSide&&(t=getVolume(retAudioArray))){drawRipples(ctx,canvas,1.15*e,retAudioArray),drawResponsiveDotRing(ctx,canvas,1.115*e,"#4CAF50",t,1),enableFlat||(drawCenterGlow(ctx,canvas,t,100),drawArcs(ctx,canvas,e,(1-.7000000000000001)*e,1.5,ringRStartColor,leftAudioSide,t,!0),drawArcs(ctx,canvas,e,(1-.7000000000000001)*e,1.5,ringLStartColor,rightAudioSide,t,!0,!1));for(let o=0;o<preL.length;o++)drawArcs(ctx,canvas,e,(1-.7000000000000001)*e,.5,colorToRgb(ringREndColor,1/preL.length*(preL.length-(o+1))),preL[o],t,!1);for(let a=0;a<preR.length;a++)drawArcs(ctx,canvas,e,(1-.7000000000000001)*e,.5,colorToRgb(ringLEndColor,1/preR.length*(preR.length-(a+1))),preR[a],t,!1);drawArcs(ctx,canvas,e,(1-.7000000000000001)*e,1.5,colorToRgb(ringRStartColor),leftAudioSide,t,!1),drawArcs(ctx,canvas,e,(1-.7000000000000001)*e,1.5,colorToRgb(ringLStartColor),rightAudioSide,t,!1),drawStereoBars(ctx,canvas,150,[75*t[0],75*t[1]]),drawTrackbar(ctx,canvas,150,[75*t[0],75*t[1]]),preL.unshift(leftAudioSide),preR.unshift(rightAudioSide),current=0,preL.length>5&&(preL.pop(),preR.pop())}let n=null!==t;n!==last_volume_state&&(last_volume_state=n,drawStatic()),drawPlayText(ctx,canvas)}function drawIcon(e,t){hasIconLoaded&&logoOpacity>0&&(e.globalAlpha=opacity*logoOpacity,e.drawImage(customIcon,(t.width-customIconWidth)/2,(t.height-customIconHeight)/2,customIconWidth,customIconHeight),e.globalAlpha=1)}function drawBackground(e,t){if(hasBackgroundLoaded&&backgroundInvalidated){backgroundInvalidated=!1;let o=backgroundImage.width,a=backgroundImage.height;o<window.innerWidth&&(a*=window.innerWidth/o,o=window.innerWidth),a<window.innerHeight&&(o*=window.innerHeight/a,a=window.innerHeight);let n=Math.sqrt(Math.pow(window.innerHeight,2))/1.8,l=bckCtx.createRadialGradient(window.innerWidth/2,window.innerHeight/2,0,window.innerWidth/2,window.innerHeight/2,n);l.addColorStop(0,colorToRgb(backgroundColorCenter,backgroundOpacity/100,!0)),l.addColorStop(1,colorToRgb(backgroundColorEdge,backgroundOpacity/100,!0)),bckCtx.drawImage(backgroundImage,(t.width-o)/2,(t.height-a)/2,o,a),bckCtx.globalCompositeOperation=getBlendMode(backgroundBlendMode),bckCtx.fillStyle=l,bckCtx.fillRect(0,0,bckCanvas.width,bckCanvas.height),bckCtx.globalCompositeOperation="normal"}}function drawCenterGlow(e,t,o,a){let n=.2*((o[0]+o[1])/2);n||(n=1);let l=t.width/2,r=t.height/2,i=e.createRadialGradient(l,r,0,l,r,2*a);i.addColorStop(0,"rgba(255,255,255,"+n*globalOpacityOverride+")"),i.addColorStop(1,"rgba(255,255,255,0)"),e.fillStyle=i,e.beginPath(),e.arc(l,r,2*a,0,TwoPi),e.closePath(),e.fill()}function drawArcs(e,t,o,a,n,l,r,i=!1,c){let d;d=smoother>0?smooth(r):r;let u=100,g=[],s=Math.ceil(d.length/(2*resolution)),$=344/d.length*s;for(let h=0;h<d.length;h+=s){let _=calculateCurvePoint(t,o,a,u,d[h],c);u+=$,!(_ in g)&&g.push(_)}e.beginPath();for(let b=0;b<g.length;b++){let p=g[b];if(g.hasOwnProperty(b+1)){let m=g[b+1];0===b?e.moveTo(p.x,p.y):e.quadraticCurveTo(p.x,p.y,(p.x+m.x)/2,(p.y+m.y)/2)}}!0===i&&(e.shadowBlur=40,e.shadowColor="rgba(0,0,0,"+globalOpacityOverride+")"),e.strokeStyle=l,e.lineWidth=n,e.stroke(),e.closePath()}function calculateCurvePoint(e,t,o,a,n){let l=Math.min(n/maxAudioValue,1),r=e.width/2,i=e.height/2,c=Math.min(o+l*(t-o)+40,t),d=-a*HalfCirclePi;return{x:r+c*cosf(d),y:i+c*sinf(d)}}function drawPlayText(){if(0===direction)opacity-=.009;else{if(1!==direction)return;opacity+=.009}opacity>.9?(direction=0,opacity=.9):opacity<min&&(direction=1,opacity=min)}function drawDotRing(e,t,o,a,n=.5){let l=resolution,r=t.width/2,i=t.height/2,c=340/l,d=HalfCirclePi,u=100;e.fillStyle=a,e.shadowColor=void 0,e.shadowBlur=void 0,e.beginPath();for(let g=0;g<l;g++){let s=r+o*cosf(-u*d),$=i+o*sinf(-u*d);e.fillRect(s-HALF_POINT_SIZE,$-HALF_POINT_SIZE,2,2),u+=c}e.closePath()}function drawRipples(e,t,o,a){let n=100,l=t.width/2,r=t.height/2;if(e.fillStyle=colorToRgb(hexToRgb(white),.7),!rippleEnabled)return;let i=340/a.length/2,c=HalfCirclePi;e.beginPath();for(let d=0;d<resolution;d++)drawRipple(a[d],l,r,o,30,n,c),n+=i,a.hasOwnProperty(d+1)?(drawRipple((a[d]+a[d+1])/2,l,r,o,30,n,c),n+=i):drawRipple(a[d]/2,l,r,o,30,n,c);e.closePath()}function drawRipple(e,t,o,a,n,l,r){let i=n*(e/maxAudioValue),c=t+(a+i)*cosf(-l*r),d=o+(a+i)*sinf(-l*r);ctx.fillRect(c-HALF_POINT_SIZE,d-HALF_POINT_SIZE,2,2)}function drawResponsiveDotRing(e,t,o,a,n){let l=resolution,r=t.width/2,i=t.height/2,c=100,d=170/(l/2),u=HalfCirclePi,g=hexToRgb(a);for(let s=0;s<2;s++){let $=n[s]*resolution/2;for(let h=0;h<resolution/2;h++){let _;_=0===s?h>$?1:.2:h<$?1:.2;let b=r+o*cosf(-c*u),p=i+o*sinf(-c*u);e.fillStyle=colorToRgb(g,_),e.fillRect(b-HALF_VOLUME_POINT_SIZE,p-HALF_VOLUME_POINT_SIZE,3,3),c+=d}}}function drawStereoBars(e,t,o,a){let n=t.width/2,l=t.height/2;e.shadowColor="rgba(0,0,0,"+.3*globalOpacityOverride+")",e.shadowBlur=40,maxVolumeHeightL=Math.max(maxVolumeHeightL,a[0]),maxVolumeHeightR=Math.max(maxVolumeHeightR,a[1]),a[0]<1&&(maxVolumeHeightL=0),a[1]<1&&(maxVolumeHeightR=0),a[1]>1&&a[0]>1&&(direction=3,opacity=min),e.fillStyle=colorToRgb(hexToRgb(white)),e.fillRect(n-o/2-2,l-2.5+-30,3,5),e.fillRect(n+o/2+2,l-2.5+-30,3,5),e.fillStyle=colorToRgb(ringLStartColor),e.fillRect(n-2-a[0],l-2.5+-30,a[0],5),e.fillStyle=colorToRgb(ringRStartColor),e.fillRect(n+2,l-2.5+-30,a[1],5),e.shadowColor="rgba(0,0,0,0)",e.shadowBlur=0}function drawTrackbar(e,t,o,a){let n=(a[0]+a[1])/2,l=o/6;volumes||(volumes=fillArray(0,l)),volumes.unshift(n),volumes.length>l&&volumes.pop(),e.fillStyle=colorToRgb(hexToRgb(white),globalOpacityOverride);let r=(t.width-o)/2;for(let i=volumes.length-1;i>-1;i--){let c=(t.height-volumes[i])/2;e.fillRect(r,c+30,2,volumes[i]),r+=6}}function getVolume(e){if(!e)return null;let t=0;for(let o=0;o<64;o++)t+=e[o];maxL=Math.max(maxL,t=t/64*15);let a=0;for(let n=64;n<128;n++)a+=e[n];return maxR=Math.max(maxR,a=a/64*15),t/=maxL,a/=maxR,t=Math.min(1,t),a=Math.min(1,a),isSound=t>.01&&a>.01,[t,a]}function fillArray(e,t){return Array(t).fill(e)}function flip(e){let t=Math.ceil(e.length/2),o=e.splice(t,e.length);return e.reverse(),o.concat(e)}function getSide(e,t){let o=Math.ceil(e.length/2);return 0===t?e.slice().splice(0,o):e.slice().splice(o,e.length)}function colorToRgb(e,t=-1,o=!1){return -1===t&&(t=.8),o||(t*=globalOpacityOverride),"rgba("+e[0]+", "+e[1]+", "+e[2]+", "+t+")"}function hexToRgb(e){let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}function rgb1StringTo255(e){let t=e.split(" "),o=[0,0,0];return o[0]=Math.min(Math.ceil(255*t[0]),255),o[1]=Math.min(Math.ceil(255*t[1]),255),o[2]=Math.min(Math.ceil(255*t[2]),255),o}function multiplyArray(e,t){return e.map(e=>e*t)}function smooth(e){let t=e.length,o=[];for(let a=0;a<t;a++)if(o.push(e[a]),a<e.length-1&&a>0){let n=e[a],l=e[a+1];o.push(Math.max(0,(n+l)/2))}return o}